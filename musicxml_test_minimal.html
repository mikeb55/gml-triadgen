<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicXML Sibelius Test - Minimal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .code-display {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
    </style>
</head>
<body>
    <h1>ðŸŽµ MusicXML Sibelius Import Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Minimal Valid MusicXML (4 Quarter Notes)</h2>
        <p>This creates the absolute minimum valid MusicXML file with C, D, E, F quarter notes.</p>
        <p><strong>Based on Dolet 8 analysis:</strong> divisions=768, no DOCTYPE</p>
        <button onclick="generateMinimalTest()">Generate Test 1</button>
        <button onclick="downloadTest1()" id="downloadTest1" style="display:none; background: #2196F3;">Download Test 1</button>
        <div id="test1Output" class="code-display" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Simple Polyrhythm (3:2)</h2>
        <p>Tests a basic 3:2 polyrhythm with proper time-modification elements.</p>
        <button onclick="generatePolyrhythmTest()">Generate Test 2</button>
        <button onclick="downloadTest2()" id="downloadTest2" style="display:none; background: #2196F3;">Download Test 2</button>
        <div id="test2Output" class="code-display" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Your Last Generated Composition</h2>
        <p>Converts your specific output to proper MusicXML.</p>
        <button onclick="generateYourComposition()">Generate Your Composition</button>
        <button onclick="downloadTest3()" id="downloadTest3" style="display:none; background: #2196F3;">Download Test 3</button>
        <div id="test3Output" class="code-display" style="display:none;"></div>
    </div>

    <div id="status" class="status"></div>

    <script>
        // Global storage for generated XML
        let test1XML = '';
        let test2XML = '';
        let test3XML = '';

        // Test 1: Minimal valid MusicXML
        function generateMinimalTest() {
            test1XML = `<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<score-partwise version="3.1">
  <part-list>
    <score-part id="P1">
      <part-name>Piano</part-name>
    </score-part>
  </part-list>
  <part id="P1">
    <measure number="1">
      <attributes>
        <divisions>768</divisions>
        <key>
          <fifths>0</fifths>
        </key>
        <time>
          <beats>4</beats>
          <beat-type>4</beat-type>
        </time>
        <clef>
          <sign>G</sign>
          <line>2</line>
        </clef>
      </attributes>
      <note>
        <pitch>
          <step>C</step>
          <octave>4</octave>
        </pitch>
        <duration>768</duration>
        <type>quarter</type>
      </note>
      <note>
        <pitch>
          <step>D</step>
          <octave>4</octave>
        </pitch>
        <duration>768</duration>
        <type>quarter</type>
      </note>
      <note>
        <pitch>
          <step>E</step>
          <octave>4</octave>
        </pitch>
        <duration>768</duration>
        <type>quarter</type>
      </note>
      <note>
        <pitch>
          <step>F</step>
          <octave>4</octave>
        </pitch>
        <duration>768</duration>
        <type>quarter</type>
      </note>
    </measure>
  </part>
</score-partwise>`;
            
            document.getElementById('test1Output').style.display = 'block';
            document.getElementById('test1Output').textContent = test1XML;
            document.getElementById('downloadTest1').style.display = 'inline-block';
            showStatus('Test 1 generated successfully!', 'success');
        }

        // Test 2: Simple polyrhythm
        function generatePolyrhythmTest() {
            test2XML = `<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<score-partwise version="3.1">
  <part-list>
    <score-part id="P1">
      <part-name>Upper Voice</part-name>
    </score-part>
    <score-part id="P2">
      <part-name>Lower Voice</part-name>
    </score-part>
  </part-list>
  <part id="P1">
    <measure number="1">
      <attributes>
        <divisions>768</divisions>
        <key>
          <fifths>0</fifths>
        </key>
        <time>
          <beats>4</beats>
          <beat-type>4</beat-type>
        </time>
        <clef>
          <sign>G</sign>
          <line>2</line>
        </clef>
      </attributes>
      <note>
        <pitch>
          <step>C</step>
          <octave>5</octave>
        </pitch>
        <duration>1024</duration>
        <type>quarter</type>
        <time-modification>
          <actual-notes>3</actual-notes>
          <normal-notes>2</normal-notes>
        </time-modification>
      </note>
      <note>
        <pitch>
          <step>E</step>
          <octave>5</octave>
        </pitch>
        <duration>1024</duration>
        <type>quarter</type>
        <time-modification>
          <actual-notes>3</actual-notes>
          <normal-notes>2</normal-notes>
        </time-modification>
      </note>
      <note>
        <pitch>
          <step>G</step>
          <octave>5</octave>
        </pitch>
        <duration>1024</duration>
        <type>quarter</type>
        <time-modification>
          <actual-notes>3</actual-notes>
          <normal-notes>2</normal-notes>
        </time-modification>
      </note>
    </measure>
  </part>
  <part id="P2">
    <measure number="1">
      <attributes>
        <divisions>768</divisions>
        <key>
          <fifths>0</fifths>
        </key>
        <time>
          <beats>4</beats>
          <beat-type>4</beat-type>
        </time>
        <clef>
          <sign>F</sign>
          <line>4</line>
        </clef>
      </attributes>
      <note>
        <pitch>
          <step>C</step>
          <octave>3</octave>
        </pitch>
        <duration>1536</duration>
        <type>half</type>
      </note>
      <note>
        <pitch>
          <step>G</step>
          <octave>3</octave>
        </pitch>
        <duration>1536</duration>
        <type>half</type>
      </note>
    </measure>
  </part>
</score-partwise>`;
            
            document.getElementById('test2Output').style.display = 'block';
            document.getElementById('test2Output').textContent = test2XML;
            document.getElementById('downloadTest2').style.display = 'inline-block';
            showStatus('Test 2 generated successfully!', 'success');
        }

        // Test 3: Your composition
        function generateYourComposition() {
            // This recreates your Section B measure 1 with proper 7:11 polyrhythm
            test3XML = `<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<score-partwise version="3.1">
  <part-list>
    <score-part id="P1">
      <part-name>Guitar</part-name>
    </score-part>
    <score-part id="P2">
      <part-name>Violin</part-name>
    </score-part>
  </part-list>
  <part id="P1">
    <measure number="1">
      <attributes>
        <divisions>768</divisions>
        <key>
          <fifths>0</fifths>
        </key>
        <time>
          <beats>4</beats>
          <beat-type>4</beat-type>
        </time>
        <clef>
          <sign>G</sign>
          <line>2</line>
          <clef-octave-change>-1</clef-octave-change>
        </clef>
      </attributes>`;
            
            // Guitar: 7 notes in the space of 4 beats
            const guitarNotes = ['A', 'B', 'A', 'F', 'E', 'G', 'C'];
            const guitarOctaves = [4, 3, 4, 3, 3, 4, 4];
            const guitarDuration = Math.floor((768 * 4) / 7); // 439
            
            for (let i = 0; i < 7; i++) {
                test3XML += `
      <note>
        <pitch>
          <step>${guitarNotes[i]}</step>
          <octave>${guitarOctaves[i]}</octave>
        </pitch>
        <duration>${guitarDuration}</duration>
        <type>eighth</type>
        <time-modification>
          <actual-notes>7</actual-notes>
          <normal-notes>4</normal-notes>
        </time-modification>
      </note>`;
            }
            
            test3XML += `
    </measure>
  </part>
  <part id="P2">
    <measure number="1">
      <attributes>
        <divisions>768</divisions>
        <key>
          <fifths>0</fifths>
        </key>
        <time>
          <beats>4</beats>
          <beat-type>4</beat-type>
        </time>
        <clef>
          <sign>G</sign>
          <line>2</line>
        </clef>
      </attributes>`;
            
            // Violin: 11 notes in the space of 4 beats
            const violinNotes = ['F', 'C', 'E', 'C', 'B', 'B', 'G', 'F', 'D', 'D', 'E'];
            const violinDuration = Math.floor((768 * 4) / 11); // 279
            
            for (let i = 0; i < 11; i++) {
                test3XML += `
      <note>
        <pitch>
          <step>${violinNotes[i]}</step>
          <octave>4</octave>
        </pitch>
        <duration>${violinDuration}</duration>
        <type>16th</type>
        <time-modification>
          <actual-notes>11</actual-notes>
          <normal-notes>4</normal-notes>
        </time-modification>
      </note>`;
            }
            
            test3XML += `
    </measure>
  </part>
</score-partwise>`;
            
            document.getElementById('test3Output').style.display = 'block';
            document.getElementById('test3Output').textContent = test3XML;
            document.getElementById('downloadTest3').style.display = 'inline-block';
            showStatus('Your composition generated successfully!', 'success');
        }

        function downloadTest1() {
            downloadXML(test1XML, 'sibelius_test_minimal.musicxml');
        }

        function downloadTest2() {
            downloadXML(test2XML, 'sibelius_test_polyrhythm_3-2.musicxml');
        }

        function downloadTest3() {
            downloadXML(test3XML, 'sibelius_test_your_composition.musicxml');
        }

        function downloadXML(content, filename) {
            const blob = new Blob([content], { type: 'application/vnd.recordare.musicxml+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            showStatus(`Downloaded ${filename}`, 'success');
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>